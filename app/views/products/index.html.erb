<script type='text/javascript'>
  console.log('the number of products is ' + '<%= @products.count %>');
</script>

<h2> Products in the market </h2>

<!--<a href="javascript:$('#highChartContainer').toggle()">Chart</a>

<a href="#" onclick="$('#highChartContainer').toggle()">Chart_onclick</a>

<a href="javascript:void(0)" onclick="$('#highChartContainer').toggle()">Chart_void(0)</a>

<a href="#" class='closeChart'>Chart</a>

<script type='text/javascript'>
  $('.closeChart').on('click', function(){
      $('#highChartContainer').toggle()
    });
</script>-->

<a href="#" data-hide-element='chart'>Chart</a>

<script type='text/javascript'>
  $('[data-hide-element=chart]').on('click', function(){
    $('#highChartContainer').toggle()
  });
</script>

<div id="highChartContainer" style="min-width: 400px; height: 400px; margin: 0 auto">

</div>

<table>
  <tbody>
    <tr>
      <th>ID</th>
      <th>Item</th>
      <th>Cost</th>
      <th>Seller</th>
    </tr>

    <% @products.each do |product| %>
      <tr>
        <td><%= product.id %></td>
      	<td><%= product.name %></td>
      	<!--<td>$<%= product.price %></td>-->
        <td data-product='<%= product.id %>'>$<%= product.price %></td>
      	<td><%= product.user.name if product.user.present? %></td>
        <!--<td><%= link_to "+", product_path(product, :product => {:price => product.price + 1}), :method => :put %></td>-->
        <td><%= link_to "+", product_path(product),
                'data-price'      => product.price,
                'data-incr-price' => product.id,
                :method => :put %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<script type='text/javascript'>
  $('[data-incr-price]').on('click', function(e){
      e.preventDefault();
      e.stopPropagation();

      var url = $(this).attr('href');
      var price = $(this).attr('data-price');
      var newPrice = parseInt(price) +1;

      //console.log(location.protocol + "//" + location.host + url);

      $.ajax({ url: url,
              type: 'put',
              dataType: 'json',
              data: { product: {price: newPrice} }
            }).success(function(data, textStatus, jqXHR) {
              $('[data-product='+ data.id +']').html("$" + data.price);
              $('[data-incr-price='+ data.id +']').attr('data-price', data.price);
              //console.log(data);
              //console.log('id is:' + data.id);
              //console.log('price is:' + data.price);
            });
      //console.log('clicked');
      //return false;
  })
</script>

<script type='text/javascript'>
  $(document).ready(function(){
      chart = new Highcharts.Chart({
        chart: {
          renderTo: 'highChartContainer',
          plotBackgroundColor: null,
          plotBorderWidth: null,
          plotShadow: false
        },
        title: {
          text: 'Browser market shares at a specific website, 2010'
        },
        series: [{
          type: 'pie',
          name: 'Product Share',
          data:
            <%=
                @products.map do |product|
                  [product.name, product.price/@sum_price]
                end.to_json.html_safe
            %>
        }]
      })
  })
</script>
